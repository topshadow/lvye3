{"version":3,"sources":["bs-app/sign-in.ts"],"names":[],"mappings":"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","file":"bs-app/sign-in.js","sourcesContent":["import { Component, OnInit, ElementRef } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\n\r\nimport { firebase, defaultWebsite, UserService, DocService, objectToArray } from 'core';\r\n\r\nimport { basicTheme } from './choose-theme/index';\r\n\r\n\r\n\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'sign-in',\r\n  templateUrl: './sign-in.html'\r\n})\r\nexport class SignIn implements OnInit {\r\n  remeberMe: boolean = false;\r\n  user: User;\r\n  firebase: any;\r\n  canRegister: boolean;\r\n  registerMessage: string;\r\n  repeatPasswordMessage: string;\r\n  docs: Doc[] = [];\r\n  doc: any = {};\r\n  themes = [basicTheme];\r\n  selectedTheme: Website = basicTheme;\r\n  // 对话框\r\n\r\n  constructor(private router: Router,\r\n    private userService: UserService,\r\n    private docService: DocService,\r\n    private el: ElementRef\r\n  ) {\r\n    this.user = { username: '', password: '', repeatPassword: '' };\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.user.username = localStorage.getItem('username') ? localStorage.getItem('username') : '';\r\n    this.user.password = localStorage.getItem('password') ? localStorage.getItem('password') : '';\r\n    this.remeberMe = localStorage.getItem('remeberMe') ? true : false;\r\n    if (this.user.username && this.user.password && this.remeberMe) {\r\n      this.signIn();\r\n    };\r\n    var docsRef = firebase.database().ref('docs');\r\n    docsRef.on('value', (snapshot) => { this.docs = objectToArray(snapshot.val()); });\r\n  }\r\n\r\n\r\n  checkUserExist() {\r\n    this.userService.getUserByUsername(this.user.username, (rtn) => {\r\n      if (rtn) {\r\n        this.canRegister = false;\r\n        this.registerMessage = '用户名已存在';\r\n      } else {\r\n        this.canRegister = true;\r\n        this.registerMessage = '';\r\n      }\r\n    });\r\n  }\r\n\r\n\r\n  signIn() {\r\n    this.userService.getUserByUsername(this.user.username, (serverUser: any) => {\r\n      if (serverUser.password == this.user.password) {\r\n        this.user = serverUser;\r\n        this.userService.user = serverUser;\r\n        // 用户没有数据则使用默认的网站数据\r\n        this.userService.user.website = serverUser.website ? serverUser.website : defaultWebsite;\r\n        if (this.remeberMe) {\r\n          localStorage.setItem('username', serverUser.username);\r\n          localStorage.setItem('password', serverUser.password);\r\n          localStorage.setItem('remeberMe', 'true');\r\n        }\r\n        window['$'](this.el.nativeElement).find('#loginModal').modal('toggle');\r\n      } else {\r\n        alert('用户名或者密码错误');\r\n      }\r\n    });\r\n  }\r\n\r\n  signDialog() {\r\n\r\n  }\r\n\r\n\r\n\r\n  signUp() {\r\n    if (this.canRegister && this.checkRepeatPassword()) {\r\n      console.log(this.user);\r\n\r\n      // 添加一个空数据的用户\r\n      this.userService.addUser({\r\n        username: this.user.username,\r\n        password: this.user.password,\r\n        website: { pages: [{ path: 'index', pageName: 'Home', parts: [] }] }\r\n      });\r\n      // 注册成功,显示选择主题面板,用户可以选择一套模板\r\n      window['$'](this.el.nativeElement).find('#chooseThemePanel').modal('toggle');\r\n    }\r\n  }\r\n\r\n  chooseTheme(website: Website) {\r\n    this.userService.user.website = website;\r\n  }\r\n\r\n  checkRepeatPassword() {\r\n    if (this.user.password != this.user.repeatPassword) {\r\n      this.repeatPasswordMessage = '两次输入的密码不同';\r\n      return false;\r\n    }\r\n    this.repeatPasswordMessage = '';\r\n    return true;\r\n  }\r\n\r\n  addDoc() {\r\n    this.docService.addDoc(this.doc);\r\n  }\r\n  deleteDoc(doc: Doc) {\r\n    this.docs.splice(this.docs.indexOf(doc), 1);\r\n    firebase.database().ref('docs').set(this.docs);\r\n  }\r\n\r\n  editLogin() {\r\n    window['isEdit'] = true;\r\n    this.router.navigate(['index',\r\n      {\r\n        username: this.userService.user.username,\r\n        password: this.userService.user.password,\r\n        edit: true\r\n      }]);\r\n  }\r\n\r\n  // 预览模式进入\r\n  previewLogin() {\r\n    window['isEdit'] = false;\r\n    this.router.navigate(['index', {\r\n      username: this.userService.user.username,\r\n      password: this.userService.user.password,\r\n      edit: false\r\n    }]);\r\n  }\r\n\r\n}\r\n\r\n"],"sourceRoot":"/source/"}